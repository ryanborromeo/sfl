generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Recipe {
  id           String             @id @default(cuid())
  title        String
  tags         String
  cookTimeMins Int
  servings     Int
  ingredients  RecipeIngredient[]
  planMeals    PlanMeal[]
  createdAt    DateTime           @default(now())
}

model Ingredient {
  id       String             @id @default(cuid())
  name     String             @unique
  category String
  recipes  RecipeIngredient[]
}

model RecipeIngredient {
  id           String     @id @default(cuid())
  recipeId     String
  ingredientId String
  quantity     Float
  unit         String
  recipe       Recipe     @relation(fields: [recipeId], references: [id])
  ingredient   Ingredient @relation(fields: [ingredientId], references: [id])

  @@unique([recipeId, ingredientId])
}

model Plan {
  id          String     @id @default(cuid())
  shareCode   String     @unique
  days        Int
  constraints String
  meals       PlanMeal[]
  createdAt   DateTime   @default(now())
}

model PlanMeal {
  id       String @id @default(cuid())
  planId   String
  dayIndex Int
  mealType String
  recipeId String
  plan     Plan   @relation(fields: [planId], references: [id])
  recipe   Recipe @relation(fields: [recipeId], references: [id])

  @@unique([planId, dayIndex, mealType])
}
